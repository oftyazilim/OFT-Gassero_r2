import{r as V,e as S}from"./validators-BJEf8OaU.js";import{d as B,r as t,cp as Y,w as y,E as z,o as I,g as $,f as o,b as l,e as F,v as L,a$ as P,n as i,ai as D,t as g,a_ as A}from"./main-CXefX_qh.js";import{_ as j}from"./AppSelect.vue_vue_type_script_setup_true_lang-UIB--c0H.js";import{_ as G}from"./AppTextField.vue_vue_type_script_setup_true_lang-B67lS2wl.js";import{a as v}from"./axios-CCb-kr4I.js";import{a as J,b as Z,V as h}from"./VCard-pJfFDOSH.js";import{V as H}from"./VDivider-B8BIZrEP.js";import{V as Q}from"./VCardText-BW9gFSa-.js";import{V as W}from"./VForm-CD_GLPlO.js";import{V as X}from"./VRow-qTTVFZ4i.js";import{V as u}from"./VCol-Dzvr-cnK.js";import{V as x}from"./VDialog-Cm1FNAkS.js";const ee={class:"text-h4 mb-2"},ce=B({__name:"AddNewUserDrawer",props:{isDrawerOpen:{type:Boolean},userData:{default:()=>({id:0,name:"",email:"",roles:"",proses:"",tip:"",unvan:""})}},emits:["update:isDrawerOpen","submit"],setup(k,{emit:q}){const n=k,f=q,b=t([]);t(!1);const d=t(),w=t(""),U=t(null),_=t(null),E=t(null),K=t(null);t("");const m=t([]),a=Y({...n.userData});y(()=>n.userData,e=>{Object.assign(a,e)}),y(()=>n.userData,e=>{e&&e.id>0?(w.value=e.name||"",U.value=e.email||"",m.value=e.roles!=""?e.roles.split(",").map(r=>r.trim()):[],E.value=e.proses||"",K.value=e.tip||"",_.value=e.unvan||""):(m.value=[],Object.assign(a,{id:0,name:"",email:"",roles:null,proses:"",tip:"",unvan:""}))},{immediate:!0}),z(()=>{M()});const M=()=>{v.get("/api/roles").then(e=>{b.value=e.data.map(r=>r)}).catch(e=>{console.error("Roller alınırken hata oluştu:",e)})},N=()=>{f("update:isDrawerOpen",!1),A(()=>{var e,r;(e=d.value)==null||e.reset(),(r=d.value)==null||r.resetValidation()})},R=()=>{var e;(e=d.value)==null||e.validate().then(({valid:r})=>{var p;r&&((p=n.userData)!=null&&p.id?(console.log(`Kullanıcı düzenleniyor: ${n.userData.id}`),T()):(console.log("Yeni kullanıcı ekleniyor:"),O()),f("update:isDrawerOpen",!1),A(()=>{var c,s;(c=d.value)==null||c.reset(),(s=d.value)==null||s.resetValidation()}))})},O=async()=>{try{const e=await v.post("/api/kullanicilar",{name:a.name,email:a.email,password:"pass1234",roles:m.value,proses:a.proses,tip:a.tip,unvan:a.unvan});console.log("Kullanıcı başarıyla oluşturuldu:",e.data)}catch(e){e.response&&e.response.data.errors?console.error("Doğrulama hataları:",e.response.data.errors):console.error("Beklenmeyen hata:",e)}f("update:isDrawerOpen",!1)},T=async()=>{try{const e=await v.put(`/api/kullanicilar/${a.id}`,{name:a.name,email:a.email,roles:m.value,proses:a.proses,tip:a.tip,unvan:a.unvan});console.log("Kullanıcı başarıyla güncellendi:",e.data)}catch(e){console.error("Kullanıcı güncellenirken hata oluştu:",e.response.data)}},C=e=>{f("update:isDrawerOpen",e)};return(e,r)=>{const p=G,c=j;return I(),$(x,{temporary:"",width:500,location:"end",class:"scrollable-content","model-value":n.isDrawerOpen,"onUpdate:modelValue":C},{default:o(()=>[l(h,{class:"pa-2 pa-sm-10"},{default:o(()=>[l(J,{class:"text-center"},{default:o(()=>[l(Z,null,{default:o(()=>[F("h4",ee,L(n.userData.id>0?"Kullanıcı Düzenle":"Yeni Kullanıcı Ekle"),1)]),_:1})]),_:1}),l(H),l(h,{flat:""},{default:o(()=>[l(Q,null,{default:o(()=>[l(W,{ref_key:"refForm",ref:d,"lazy-validation":"",onSubmit:P(R,["prevent"])},{default:o(()=>[l(X,null,{default:o(()=>[l(u,{cols:"12"},{default:o(()=>[l(p,{modelValue:a.name,"onUpdate:modelValue":r[0]||(r[0]=s=>a.name=s),rules:["requiredValidator"in e?e.requiredValidator:i(V)],label:"Adı Soyadı",placeholder:"Ali VELİ"},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12"},{default:o(()=>[l(p,{modelValue:a.email,"onUpdate:modelValue":r[1]||(r[1]=s=>a.email=s),rules:["requiredValidator"in e?e.requiredValidator:i(V),"emailValidator"in e?e.emailValidator:i(S)],label:"Email",placeholder:"aliveli@email.com"},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12"},{default:o(()=>[l(p,{modelValue:a.unvan,"onUpdate:modelValue":r[2]||(r[2]=s=>a.unvan=s),rules:["requiredValidator"in e?e.requiredValidator:i(V)],label:"Ünvan",placeholder:"Yönetici"},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12"},{default:o(()=>[l(c,{modelValue:a.proses,"onUpdate:modelValue":r[3]||(r[3]=s=>a.proses=s),rules:["requiredValidator"in e?e.requiredValidator:i(V)],label:"Görev Yeri (Proses)",items:["GENEL","SERPANTİN BÜKÜM","UÇ AÇMA","YIKAMAVE SIZDIRMAZLIK","SİPİR AÇMA","EŞANJÖR MONTAJ"]},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12"},{default:o(()=>[l(c,{modelValue:a.tip,"onUpdate:modelValue":r[4]||(r[4]=s=>a.tip=s),rules:["requiredValidator"in e?e.requiredValidator:i(V)],label:"Kademe",items:["YÖNETİM","ÜRETİM"]},null,8,["modelValue","rules"])]),_:1}),l(u,{cols:"12"},{default:o(()=>[l(c,{modelValue:m.value,"onUpdate:modelValue":r[5]||(r[5]=s=>m.value=s),rules:["requiredValidator"in e?e.requiredValidator:i(V)],items:b.value,"item-title":"name","menu-props":{maxHeight:"400"},label:"Roller",multiple:"","persistent-hint":"",placeholder:"Rol seçiniz..."},null,8,["modelValue","rules","items"])]),_:1}),l(u,{cols:"12",class:"text-center mt-2"},{default:o(()=>[l(D,{type:"submit",class:"me-3"},{default:o(()=>[g(" Kaydet ")]),_:1}),l(D,{type:"reset",variant:"tonal",color:"error",onClick:N},{default:o(()=>[g(" Vazgeç ")]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])}}});export{ce as _};
