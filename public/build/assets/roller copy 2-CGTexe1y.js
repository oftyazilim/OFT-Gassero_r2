import{a as T,b as l,e as h,i as $,d as b,D as c,t as _}from"./data-grid-BLmUHH6D.js";import{a as d}from"./axios-CCb-kr4I.js";import{u as B}from"./pageTitle-BB4Xy5Fv.js";import{d as I,r as n,o as p,c as V,e as G,g as D,f as u,b as o,n as a}from"./main-CXefX_qh.js";import"./index-xGAhBz7B.js";const U={class:"grids"},q=I({__name:"roller copy 2",setup(E){const v=B();v.setTitle("Kullanıcı Rolleri"),v.setToplam(""),document.title="OFT - Roller";const w=n([]),f=n([]),r=n([]),s=n([]),i=n([]),x=n(0),y=n(0),g=e=>e&&["ALL"].indexOf(e.trim().toUpperCase())>=0,A=e=>!g(e.row.data.name),R=e=>!g(e.row.data.name),k=async()=>{const{data:e}=await d.get("/api/roles-count");w.value=e},P=async()=>{const e=await d.get(`/api/roles-users/${r.value.name}`);f.value=e.data},S=async()=>{if(!r.value)return;const{data:e}=await d.get(`/api/roles/${r.value.id}/permissions`);i.value=e.assigned,s.value=e.available},K=async e=>{try{const t=e.itemData;if(!r.value||!t)return;i.value.push(t),s.value=s.value.filter(m=>m.id!==t.id),i.value=[...i.value],s.value=[...s.value],await d.post(`/api/roles/${r.value.id}/permissions`,{permission_id:t.id})}catch(t){console.error("İzin atama işlemi başarısız oldu:",t)}},z=async e=>{const t=e.itemData;!r.value||!t||(s.value.push(t),i.value=i.value.filter(m=>m.id!==t.id),i.value=[...i.value],s.value=[...s.value],await d.delete(`/api/roles/${r.value.id}/permissions/${t.id}`))};k();const C=e=>{const t=e.row.data;r.value=t,S(),P()};return(e,t)=>(p(),V("div",null,[G("div",U,[(p(),D(a(c),{"data-source":w.value,key:x.value,"key-expr":"id","show-borders":!0,width:"400","columns-auto-width":!0,"row-alternation-enabled":!0,"focused-row-enabled":!0,"show-indicator":!0,onFocusedRowChanged:C},{default:u(()=>[o(a(T),{"allow-updating":R,"allow-adding":!0,"allow-deleting":A,"use-icons":!0,mode:"form"}),o(a(l),{"data-field":"id",caption:"Rol ID",width:"60","allow-editing":!1}),o(a(l),{"data-field":"name",caption:"Rol Adı",width:"120"}),o(a(l),{"data-field":"users_count",caption:"Kullanıcı Sayısı",width:"120"}),o(a(h),{mode:"virtual","column-rendering-mode":"virtual"}),o(a($),{visible:!0,width:240,placeholder:"Ara..."}),o(a(b),{mode:"none"})]),_:1},8,["data-source"])),(p(),D(a(c),{"data-source":f.value,key:y.value,"key-expr":"id","show-borders":!0,width:"300",title:"Atanmış İzinler","columns-auto-width":!0,"row-alternation-enabled":!1,"focused-row-enabled":!0,"show-indicator":!0,"allow-column-reordering":!0},{default:u(()=>[o(a(l),{caption:"Atanmış Kullanıcılar",alignment:"center"},{default:u(()=>[o(a(l),{"data-field":"id",caption:"ID",width:"60","allow-editing":!1}),o(a(l),{"data-field":"name",caption:"Kullanıcı Adı",width:"200"})]),_:1}),o(a(h),{mode:"virtual","column-rendering-mode":"virtual"}),o(a(b),{mode:"none"})]),_:1},8,["data-source"])),o(a(c),{"data-source":s.value,"show-borders":!0},{default:u(()=>[o(a(_),{group:"permissionsGroup","on-add":z}),o(a(l),{"data-field":"name",caption:"Atanmamış İzinler"})]),_:1},8,["data-source"]),o(a(c),{"data-source":i.value,"show-borders":!0},{default:u(()=>[o(a(_),{group:"permissionsGroup","on-add":K}),o(a(l),{"data-field":"name",caption:"Atanmış İzinler"})]),_:1},8,["data-source"])])]))}});export{q as default};
